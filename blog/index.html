<!DOCTYPE html>
<html lang="zh-TW" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>莫比空間</title>
    
    <link rel="icon" href="https://x-easy.github.io/medias/莫比音樂Logo.jpeg" type="image/jpeg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-body: #000000; --bg-container: #111111; --bg-card: #222222;
            --bg-input: #333333; --text-main: #ffffff; --text-sub: #aaaaaa;
            --border-color: #333333; --accent-color: #06c755; --nav-bg: #111111;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg-body); color: var(--text-main); overflow: hidden; }
        
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-container); height: 100vh; position: relative; display: flex; flex-direction: column; }

        /* 原有樣式保持 */
        .app-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; flex-shrink: 0; }
        .line-music-player { display: flex; align-items: center; background-color: var(--bg-input); padding: 4px 12px; border-radius: 20px; flex: 1; margin-right: 10px; height: 38px; cursor: pointer; }
        .music-title-scroll { font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .header-icons { display: flex; gap: 10px; }
        .icon-btn { background: none; border: none; color: var(--text-main); font-size: 10px; display: flex; flex-direction: column; align-items: center; }
        .icon-btn i { font-size: 18px; margin-bottom: 2px; padding: 5px; border: 1px solid var(--text-main); border-radius: 8px; }

        /* 新增：新聞列表樣式 */
        .article-item { display: flex; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.2s; }
        .article-item:active { background: var(--bg-card); }
        .article-img { width: 90px; height: 90px; border-radius: 10px; object-fit: cover; background: #333; }
        .article-content { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .article-title { font-size: 15px; font-weight: 600; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .article-meta { font-size: 11px; color: var(--text-sub); display: flex; justify-content: space-between; }

        /* 輪播與導航 (保持原有樣式) */
        .featured-carousel { padding: 10px 15px; overflow-x: auto; display: flex; gap: 12px; scroll-snap-type: x mandatory; }
        .featured-carousel::-webkit-scrollbar { display: none; }
        .featured-card { min-width: 85%; height: 160px; background-size: cover; background-position: center; border-radius: 15px; position: relative; scroll-snap-align: center; flex-shrink: 0; }
        .featured-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 40px 15px 15px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); }
        
        /* 底部導航 */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto; height: 60px; background-color: var(--nav-bg); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-sub); text-decoration: none; font-size: 10px; }
        .nav-item.active { color: var(--accent-color); }

        /* 全屏閱讀器 */
        #reader-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 5000; display: none; flex-direction: column; }
        .reader-header { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        #reader-frame { flex: 1; border: none; width: 100%; }

        /* 模態框與公告樣式保持... */
        .half-modal-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 4000; display: none; }
        .half-modal-container.show { display: block; }
        .modal-btn-group { display: flex; gap: 10px; padding: 15px; background: var(--bg-container); }
    </style>
</head>
<body>

    <div id="app-container">
        <header class="app-header">
            <div class="line-music-player" id="miniPlayer">
                <i class="fa-solid fa-music" style="color: var(--accent-color); margin-right: 8px;"></i>
                <div class="music-title-scroll">自動抓取：今日熱門新聞...</div>
            </div>
            <div class="header-icons">
                <button class="icon-btn" onclick="toggleAnnouncement(true)"><i class="fa-solid fa-scroll"></i><span>公告</span></button>
            </div>
        </header>

        <main id="main-view" style="flex:1; overflow-y:auto; padding-bottom:80px;"></main>

        <nav class="bottom-nav">
            <a href="/" class="nav-item active"><i class="fa-solid fa-house"></i><span>首頁</span></a>
            <a href="/explore" class="nav-item"><i class="fa-solid fa-compass"></i><span>探索</span></a>
            <a href="https://x-easy.github.io/shorts" class="nav-item"><i class="fa-brands fa-youtube"></i><span>Shorts</span></a>
            <a href="/settings" class="nav-item"><i class="fa-solid fa-gear"></i><span>設定</span></a>
        </nav>
    </div>

    <div id="reader-view">
        <div class="reader-header">
            <button onclick="closeReader()" style="background:none; border:none; color:#fff; font-size:20px;"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="reader-source" style="font-size: 14px; font-weight: bold;">新聞閱讀</span>
            <button onclick="shareReader()" style="background:none; border:none; color:#fff; font-size:18px;"><i class="fa-solid fa-arrow-up-from-bracket"></i></button>
        </div>
        <iframe id="reader-frame" src=""></iframe>
    </div>

    <div id="announcementModal" class="half-modal-container">
        <div style="background:var(--bg-card); width:100%; height:85vh; border-radius:20px 20px 0 0; position:absolute; bottom:0; display:flex; flex-direction:column; overflow:hidden;">
            <div style="padding: 15px; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: bold;">系統公告</div>
            <iframe src="https://x-easy.github.io/" style="flex:1; border:none; width:100%;"></iframe>
            <div class="modal-btn-group">
                <button style="flex:1; padding:12px; background:var(--bg-input); color:#fff; border-radius:8px; border:none;" onclick="window.open('https://x-easy.github.io/', '_blank')">返回原頁</button>
                <button style="flex:1; padding:12px; background:var(--accent-color); color:#fff; border-radius:8px; border:none;" onclick="toggleAnnouncement(false)">關閉</button>
            </div>
        </div>
    </div>

    <script>
        // RSS 新聞源 (這些是 LINE TODAY 常見的新聞供應商)
        const RSS_SOURCES = [
            "https://feeds.feedburner.com/ettoday/realtime", // ETtoday
            "https://news.google.com/rss?hl=zh-TW&gl=TW&ceid=TW:zh-Hant" // Google 新聞
        ];

        async function fetchNews() {
            const mainView = document.getElementById('main-view');
            // 隨機選一個新聞源抓取
            const selectedRSS = RSS_SOURCES[Math.floor(Math.random() * RSS_SOURCES.length)];
            const API_URL = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(selectedRSS)}`;

            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                if (data.status === 'ok') {
                    renderHome(data.items);
                }
            } catch (err) {
                mainView.innerHTML = `<div style="padding:50px; text-align:center; color:gray;">新聞加載失敗，請檢查網路。</div>`;
            }
        }

        function renderHome(articles) {
            const mainView = document.getElementById('main-view');
            
            // 1. 精選文章 (取前 2 則)
            const featuredHtml = `<section class="featured-carousel">
                ${articles.slice(0, 3).map(a => `
                    <div class="featured-card" style="background-image: url('${a.thumbnail || 'https://images.unsplash.com/photo-1504711432869-efd597cdd042?w=500'}')" onclick="openReader('${a.link}', '${a.author}')">
                        <div class="featured-overlay"><h4>${a.title}</h4></div>
                    </div>
                `).join('')}
            </section>`;

            // 2. 文章列表 (其餘新聞)
            const listHtml = articles.slice(3).map(a => `
                <div class="article-item" onclick="openReader('${a.link}', '${a.author || '莫比新聞'}')">
                    <img src="${a.thumbnail || 'https://via.placeholder.com/150/222222/ffffff?text=Mobispace'}" class="article-img">
                    <div class="article-content">
                        <div class="article-title">${a.title}</div>
                        <div class="article-meta">
                            <span>${a.author || '焦點新聞'}</span>
                            <span>${new Date(a.pubDate).toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            mainView.innerHTML = featuredHtml + listHtml;
        }

        // 閱讀器功能
        let currentUrl = "";
        function openReader(url, source) {
            currentUrl = url;
            document.getElementById('reader-view').style.display = 'flex';
            document.getElementById('reader-frame').src = url;
            document.getElementById('reader-source').innerText = source;
        }

        function closeReader() {
            document.getElementById('reader-view').style.display = 'none';
            document.getElementById('reader-frame').src = "";
        }

        function shareReader() {
            if (navigator.share) {
                navigator.share({ title: '分享新聞', url: currentUrl });
            }
        }

        function toggleAnnouncement(show) {
            document.getElementById('announcementModal').classList.toggle('show', show);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', fetchNews);
    </script>
</body>
</html>
