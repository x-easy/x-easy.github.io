<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<title id="seo-title">mobispace</title>
<meta id="seo-desc" name="description" content="mobispace WebApp 平台">

<meta property="og:title" content="mobispace">
<meta property="og:description" content="搜尋 × 內容 × 模組化平台">
<meta property="og:type" content="website">

<script id="seo-jsonld" type="application/ld+json"></script>

<!-- =======================
 PWA 全套 Manifest (含 icons)
======================= -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;mobispace&quot;,
  &quot;short_name&quot;:&quot;mobispace&quot;,
  &quot;start_url&quot;:&quot;/&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#000000&quot;,
  &quot;theme_color&quot;:&quot;#000000&quot;,
  &quot;icons&quot;:[
    {&quot;src&quot;:&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAA...&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;},
    {&quot;src&quot;:&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAA...&quot;,&quot;sizes&quot;:&quot;512x512&quot;,&quot;type&quot;:&quot;image/png&quot;}
  ]
}">

<meta name="theme-color" content="#000000">

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<style>
body{background:#000;color:#eee;font-family:system-ui;padding-bottom:80px}
header,nav{position:fixed;left:0;width:100%;background:#050505}
header{top:0;padding:12px}
nav{bottom:0;display:flex;justify-content:space-around;padding:12px}
#app{padding:80px 12px}
.item{border-bottom:1px solid #111;padding:16px}
a{color:#0f0;text-decoration:none}
button{background:#111;color:#eee;border:0;padding:10px 14px;border-radius:10px}
</style>
</head>

<body>

<header>mobispace WebApp</header>

<div id="app"></div>

<nav>
<button onclick="route('/')">首頁</button>
<button onclick="route('/articles')">文章</button>
<button onclick="generateSitemap()">產生 Sitemap</button>
</nav>

<script>
/* ===============================
  路由系統 (History API)
================================ */
function route(path){
  history.pushState({}, "", path);
  render();
}
window.onpopstate = render;

/* ===============================
  CMS 文章索引 (真實檔案列表)
  → 對應 /posts/*
================================ */
const postIndex = [
  {slug:"hello", file:"/posts/hello.md", title:"Hello World"},
  {slug:"guide", file:"/posts/guide.html", title:"使用指南"},
  {slug:"data", file:"/posts/data.json", title:"JSON 範例"}
];

/* ===============================
  Render 核心
================================ */
async function render(){
  const path = location.pathname;
  const app = document.getElementById("app");

  if(path === "/"){
    app.innerHTML = `<h2>首頁</h2>`;
  }

  else if(path === "/articles"){
    app.innerHTML = postIndex.map(p=>
      `<div class="item"><a href="/post/${p.slug}" onclick="event.preventDefault();route('/post/${p.slug}')">${p.title}</a></div>`
    ).join("");
  }

  else if(path.startsWith("/post/")){
    const slug = path.split("/post/")[1];
    const post = postIndex.find(p=>p.slug===slug);
    if(!post){ app.innerHTML="404"; return; }

    const res = await fetch(post.file);
    let content = await res.text();

    if(post.file.endsWith(".md")) content = marked.parse(content);
    if(post.file.endsWith(".json")) content = `<pre>${content}</pre>`;

    app.innerHTML = `<div class="item">${content}</div>`;

    updateSEO(post.title, content.replace(/<[^>]+>/g,"").slice(0,120));
  }
}
render();

/* ===============================
 SEO 動態更新
================================ */
function updateSEO(title,desc){
  document.getElementById("seo-title").textContent = title;
  document.getElementById("seo-desc").content = desc;

  document.getElementById("seo-jsonld").textContent = JSON.stringify({
    "@context":"https://schema.org",
    "@type":"Article",
    "headline":title,
    "description":desc,
    "url":location.href
  });
}

/* ===============================
 Sitemap.xml 生成器
================================ */
function generateSitemap(){
  const urls = [
    "/",
    "/articles",
    ...postIndex.map(p=>`/post/${p.slug}`)
  ];

  const xml = `<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n` +
    urls.map(u=>`<url><loc>${location.origin}${u}</loc></url>`).join("\n") +
    "\n</urlset>";

  const blob = new Blob([xml],{type:"application/xml"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "sitemap.xml";
  a.click();
}

/* ===============================
 PWA Service Worker
================================ */
if('serviceWorker' in navigator){
  const sw = new Blob([`
    self.addEventListener('install',e=>{
      e.waitUntil(caches.open('v1').then(c=>c.addAll(['/'])));
    });
    self.addEventListener('fetch',e=>{
      e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
    });
  `],{type:'text/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(sw));
}
</script>

</body>
</html>
