<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- ================= SEO æ——è‰¦ç´šåŸºç¤ ================= -->
<title>Mobispace Flagship Editor</title>
<meta name="description" content="Mobispace é›¢ç·šå¯ç”¨ã€å¤šåˆ†é ã€Markdownã€Monaco ç·¨è¼¯å™¨ï¼Œæ”¯æ´å¤šæ ¼å¼åŒ¯å‡ºçš„æ——è‰¦ç´šç­†è¨˜ç³»çµ±">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://example.com/editor">

<!-- Open Graph -->
<meta property="og:title" content="Mobispace Flagship Editor">
<meta property="og:description" content="é›¢ç·šç­†è¨˜ Ã— Markdown Ã— IDE ç­‰ç´šç·¨è¼¯é«”é©—">
<meta property="og:type" content="website">

<!-- PWA Manifestï¼ˆå‹•æ…‹ç”¢ç”Ÿï¼Œé¿å…æ‹†æª”ï¼‰ -->
<script>
const manifest = {
  name: "Mobispace Editor",
  short_name: "Mobispace",
  start_url: ".",
  display: "standalone",
  background_color: "#000000",
  theme_color: "#111111",
  icons: [
    { src: "data:image/svg+xml;base64," + btoa(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='black'/><text x='50%' y='55%' fill='white' font-size='40' text-anchor='middle'>M</text></svg>`), sizes: "192x192", type: "image/svg+xml" }
  ]
};
const blob = new Blob([JSON.stringify(manifest)], {type: "application/json"});
document.head.appendChild(Object.assign(document.createElement("link"), {rel:"manifest", href:URL.createObjectURL(blob)}));
</script>

<!-- CDN libs -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>

<style>
/* ================================
   Flagship Responsive Layout
================================ */
body {
  margin:0;
  background:#000;
  color:#eee;
  font-family:"Noto Sans TC", system-ui;
}

#mobispace-editor {
  max-width: 1100px;
  margin:auto;
  padding:20px;
}

/* ç·¨è¼¯ + é è¦½ é›™æ¬„ï¼Œæ‰‹æ©Ÿè‡ªå‹•è®Šå–®æ¬„ */
.editor-main {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media(max-width:768px){
  .editor-main { grid-template-columns:1fr; }
}

/* æ–‡å­—å€ */
textarea, #preview, #monaco {
  background:#111;
  color:#fff;
  border:1px solid #333;
  border-radius:10px;
  padding:12px;
  min-height:280px;
}

/* å·¥å…·åˆ—ï¼ˆä¸‹æ‹‰å¼æ§åˆ¶ï¼‰ */
.toolbar {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:12px 0;
}
select, input {
  background:#111;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  padding:6px;
}

/* Tab åˆ—ç§»åˆ°åº•éƒ¨ */
#tabBar {
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:12px;
}
.tab {
  background:#333;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  color:#fff;
  cursor:pointer;
}
.tab.active { background:#4caf50; }

/* SVG icon çµ±ä¸€æ¨£å¼ */
svg.icon {
  width:16px;
  height:16px;
  fill:currentColor;
  vertical-align:middle;
}
</style>
</head>

<body>
<section id="mobispace-editor">

<h2 style="text-align:center">â²˜ğ”¬â³ğ”­â²ğ” â²‰ Flagship Editor</h2>

<!-- ===== å·¥å…·åˆ—ï¼šå…¨éƒ¨æ”¹ç‚ºä¸‹æ‹‰æ§åˆ¶ ===== -->
<div class="toolbar">

  <!-- æ¨¡å¼åˆ‡æ› -->
  <select id="modeSelect">
    <option value="normal">ä¸€èˆ¬ç·¨è¼¯æ¨¡å¼</option>
    <option value="monaco">Monaco IDE æ¨¡å¼</option>
  </select>

  <!-- ä¸‹è¼‰æ ¼å¼ -->
  <select id="formatSelect">
    <option value="md">ä¸‹è¼‰ .md</option>
    <option value="txt">ä¸‹è¼‰ .txt</option>
    <option value="html">ä¸‹è¼‰ .html</option>
    <option value="zip">ä¸‹è¼‰ .zipï¼ˆå…¨éƒ¨ï¼‰</option>
  </select>

  <!-- ä¸‹è¼‰ç¯„åœ -->
  <select id="rangeSelect">
    <option value="single">åƒ…ç›®å‰é </option>
    <option value="all">å…¨éƒ¨ç­†è¨˜</option>
  </select>

  <!-- è‡ªè¨‚æª”å -->
  <input id="filenameInput" placeholder="æª”åï¼ˆä¸å«å‰¯æª”åï¼‰" />

  <!-- æ“ä½œ -->
  <select id="actionSelect">
    <option value="">é¸æ“‡æ“ä½œ</option>
    <option value="add">æ–°å¢ç­†è¨˜</option>
    <option value="delete">åˆªé™¤ç›®å‰ç­†è¨˜</option>
    <option value="download">åŸ·è¡Œä¸‹è¼‰</option>
  </select>

</div>

<!-- ===== ç·¨è¼¯å€ ===== -->
<div class="editor-main">
  <textarea id="textArea" placeholder="è¼¸å…¥ Markdown..."></textarea>
  <div id="preview">Markdown Preview</div>
</div>

<div id="monaco" style="display:none;"></div>

<!-- ===== Tab ç§»åˆ°åº•éƒ¨ ===== -->
<div id="tabBar"></div>

<p id="status" style="text-align:center;font-size:13px;color:#888;">Ready</p>
</section>

<script>
/* ==========================================================
   Mobispace Flagship Editor Engine v2
========================================================== */

/* ---------- IndexedDB ---------- */
const DB="mobispaceDB", STORE="notes";
let db, current=1, tabs=[1];

indexedDB.open(DB,1).onupgradeneeded=e=>{
  e.target.result.createObjectStore(STORE,{keyPath:"id"});
};
indexedDB.open(DB,1).onsuccess=e=>{
  db=e.target.result;
  load(1);
  renderTabs();
};

/* ---------- DOM ---------- */
const ta=textArea, prev=preview, statusEl=status;

/* ---------- Markdown ---------- */
ta.oninput=()=>{
  prev.innerHTML=marked.parse(ta.value);
  save();
};

/* ---------- å„²å­˜ ---------- */
function save(){
  db.transaction(STORE,"readwrite").objectStore(STORE)
  .put({id:current,content:ta.value});
}

/* ---------- è¼‰å…¥ ---------- */
function load(id){
  db.transaction(STORE).objectStore(STORE)
  .get(id).onsuccess=e=>{
    ta.value=e.target.result?.content||"";
    prev.innerHTML=marked.parse(ta.value);
  };
}

/* ---------- Tabs ---------- */
function renderTabs(){
  tabBar.innerHTML="";
  tabs.forEach(id=>{
    const b=document.createElement("button");
    b.className="tab"+(id===current?" active":"");
    b.textContent=id;
    b.onclick=()=>{current=id;load(id);renderTabs();}
    tabBar.appendChild(b);
  });
}

/* ---------- æ§åˆ¶ä¸­å¿ƒ ---------- */
actionSelect.onchange=()=>{
  const v=actionSelect.value;
  actionSelect.value="";
  if(v==="add"){ tabs.push(tabs.length+1); renderTabs(); }
  if(v==="delete"){
    if(confirm("åˆªé™¤ç›®å‰é ï¼Ÿ")){
      tabs=tabs.filter(t=>t!==current);
      current=tabs[0]||1;
      renderTabs(); load(current);
    }
  }
  if(v==="download") download();
};

/* ---------- ä¸‹è¼‰è™•ç† ---------- */
async function download(){
  const name=filenameInput.value||"mobispace";
  const format=formatSelect.value;
  const range=rangeSelect.value;

  if(format==="zip"){
    const zip=new JSZip();
    for(const id of tabs){
      const req=await new Promise(r=>{
        const tx=db.transaction(STORE).objectStore(STORE).get(id);
        tx.onsuccess=()=>r(tx.result?.content||"");
      });
      zip.file(`${name}_${id}.md`,req);
    }
    const blob=await zip.generateAsync({type:"blob"});
    trigger(blob,`${name}.zip`);
    return;
  }

  const content=ta.value;
  let data=content, ext=format;

  if(format==="html") data=`<html><body>${marked.parse(content)}</body></html>`;

  trigger(new Blob([data]),`${name}.${ext}`);
}

function trigger(blob,filename){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=filename;
  a.click();
}

/* ---------- Monaco ---------- */
require.config({ paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs"}});
require(["vs/editor/editor.main"],()=>{
  const editor=monaco.editor.create(monaco,{
    value:"",
    language:"markdown",
    theme:"vs-dark",
    automaticLayout:true
  });

  modeSelect.onchange=()=>{
    if(modeSelect.value==="monaco"){
      editor.setValue(ta.value);
      editor.onDidChangeModelContent(()=>{ ta.value=editor.getValue(); ta.oninput(); });
      document.querySelector(".editor-main").style.display="none";
      monaco.style.display="block";
    } else {
      document.querySelector(".editor-main").style.display="grid";
      monaco.style.display="none";
    }
  };
});

/* ---------- Service Worker ---------- */
if("serviceWorker"in navigator){
  const sw=`self.addEventListener('fetch',e=>{});`;
  navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw])));
}
</script>
</body>
</html>
