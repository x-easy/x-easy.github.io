<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobi IDE | å°ˆæ¥­å¯è¦–åŒ–ç·¨è¼¯å™¨</title>
    <script src="data.js"></script>
    <style>
        :root {
            /* [è¨­å®š]ï¼šGitHub Dark é…è‰²èˆ‡ UI è®Šæ•¸ */
            --bg-main: #0d1117; 
            --bg-panel: #161b22;
            --border: #30363d;
            --active-red: #ff3333;
            --syntax-blue: #58a6ff;
            --syntax-white: #f0f6fc;
            --text-gray: #8b949e;
            --transition: 0.25s ease;
        }

        /* [æ¨¡å¼]ï¼šç¶²ç«™å…‰äº®æ¨¡å¼è¦†è“‹æ¨£å¼ */
        body.light-mode {
            --bg-main: #ffffff;
            --bg-panel: #f6f8fa;
            --border: #d0d7de;
            --syntax-white: #24292f;
            --text-gray: #57606a;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; font-family: -apple-system, system-ui, sans-serif; 
            background: var(--bg-main); color: var(--syntax-white); 
            height: 100vh; display: flex; flex-direction: column; 
            transition: background var(--transition);
        }

        /* [é ‚éƒ¨æ¬„]ï¼šç´” SVG åœ–ç¤ºåŒ–æ§åˆ¶ */
        header { 
            padding: 8px 16px; display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid var(--border); background: var(--bg-main);
        }

        .icon-btn {
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border-radius: 8px; transition: var(--transition);
        }
        .icon-btn:active { background: var(--border); transform: scale(0.9); }
        .icon-btn img { width: 22px; height: 22px; }

        /* [æ ¸å¿ƒä½ˆå±€ç³»çµ±] */
        .main-container { flex: 1; display: flex; overflow: hidden; position: relative; }
        
        /* [ä¸‰æ¬„æ¨¡å¼]ï¼šHTML, CSS, JS ä¸¦æ’ */
        .layout-three .pane { flex: 1; display: flex !important; flex-direction: column; border-right: 1px solid var(--border); }
        .pane-label { padding: 4px 12px; font-size: 10px; color: var(--text-gray); background: var(--bg-panel); border-bottom: 1px solid var(--border); }

        /* [å–®æ¬„æ¨¡å¼]ï¼šåƒ…é¡¯ç¤º HTML */
        .layout-single .pane { display: none; width: 100%; }
        .layout-single #pane-html { display: flex; flex-direction: column; }
        .layout-single #pane-css, .layout-single #pane-js { display: none !important; }

        textarea { 
            flex: 1; width: 100%; background: transparent; color: inherit; 
            border: none; padding: 15px; font-family: 'Fira Code', monospace; 
            font-size: 15px; resize: none; line-height: 1.5;
        }

        /* [å…¨è¢å¹•é è¦½å±¤] */
        #preview-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 1000; display: none;
        }
        #preview-layer.active { display: flex; flex-direction: column; }

        /* [è¨­å®šé¢æ¿] */
        #settings-modal {
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 60%;
            background: var(--bg-panel); border-top: 1px solid var(--border);
            z-index: 2000; transition: var(--transition); padding: 20px;
            border-radius: 16px 16px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        #settings-modal.active { bottom: 0; }

        /* [åº•éƒ¨æ§åˆ¶åˆ—] */
        .btn-group { 
            display: flex; gap: 12px; padding: 12px 20px; 
            background: var(--bg-panel); border-top: 1px solid var(--border); 
        }
        .action-btn { 
            flex: 1; height: 44px; border-radius: 10px; border: 1px solid var(--border); 
            background: var(--bg-main); color: white; display: flex; 
            align-items: center; justify-content: center; cursor: pointer; 
        }
        .btn-play { background: var(--active-red); border-color: var(--active-red); }

        #file-input { display: none; }
    </style>
</head>
<body class="layout-three"> <header>
    <div style="display: flex; align-items: center; gap: 8px;">
        <div class="icon-btn" onclick="toggleSettings()">
            <img src="https://x-easy.github.io/assets/icons/svg/settings.svg" alt="è¨­å®š">
        </div>
        <span style="font-size: 14px; font-weight: 900; letter-spacing: 1px;">MOBI IDE</span>
    </div>
    
    <div style="display: flex; gap: 5px;">
        <div class="icon-btn" id="save-indicator">
            <img src="https://x-easy.github.io/assets/icons/svg/floppy_disk.svg" alt="ä¿å­˜ä¸­">
        </div>
        <div class="icon-btn" onclick="document.getElementById('file-input').click()">
            <img src="https://x-easy.github.io/assets/icons/svg/import.svg" alt="ä¸Šå‚³">
        </div>
    </div>
</header>

<div class="main-container" id="editor-container">
    <div id="pane-html" class="pane">
        <div class="pane-label">HTML5</div>
        <textarea id="code-html" oninput="autoSave()" placeholder="å¯«å…¥ HTML..."></textarea>
    </div>
    <div id="pane-css" class="pane">
        <div class="pane-label">CSS3</div>
        <textarea id="code-css" oninput="autoSave()" placeholder="å¯«å…¥ CSS..."></textarea>
    </div>
    <div id="pane-js" class="pane">
        <div class="pane-label">JAVASCRIPT</div>
        <textarea id="code-js" oninput="autoSave()" placeholder="å¯«å…¥ JS..."></textarea>
    </div>
</div>

<div class="btn-group">
    <button class="action-btn btn-play" onclick="togglePreview(true)">
        <img src="https://x-easy.github.io/assets/icons/svg/play_1.svg" style="filter: invert(1); width: 24px;">
    </button>
    <button class="action-btn" onclick="downloadLogic()">
        <img src="https://x-easy.github.io/assets/icons/svg/save_down_1.svg">
    </button>
    <button class="action-btn" onclick="clearAll()">
        <img src="https://x-easy.github.io/assets/icons/svg/trash.svg">
    </button>
</div>

<div id="preview-layer">
    <div style="padding: 10px; background: #222; display: flex; justify-content: flex-end;">
        <div class="icon-btn" onclick="togglePreview(false)" style="background: #ff4444;">
            <img src="https://x-easy.github.io/assets/icons/svg/square_remove.svg" style="filter: invert(1);">
        </div>
    </div>
    <iframe id="output-frame" style="flex: 1; width: 100%; border: none;"></iframe>
</div>

<div id="settings-modal">
    <h3 style="margin-top: 0;">IDE è‡ªå®šç¾©è¨­å®š</h3>
    <div style="display: flex; flex-direction: column; gap: 15px;">
        <label>ä½ˆå±€æ¨¡å¼ï¼š
            <select onchange="changeLayout(this.value)" style="width: 100%; padding: 8px;">
                <option value="layout-three">ä¸‰æ¬„æ¨¡å¼ (HTML+CSS+JS)</option>
                <option value="layout-single">å–®æ¬„æ¨¡å¼ (åƒ… HTML)</option>
            </select>
        </label>
        <label>ä¸‹è¼‰æ ¼å¼ï¼š
            <select id="dl-format" style="width: 100%; padding: 8px;">
                <option value="html">HTML (å®Œæ•´å°è£)</option>
                <option value="md">Markdown (.md)</option>
                <option value="txt">ç´”æ–‡æœ¬ (.txt)</option>
            </select>
        </label>
        <button class="action-btn" onclick="document.body.classList.toggle('light-mode')">
            ğŸŒ“ åˆ‡æ›å…‰/æš—æ¨¡å¼
        </button>
        <div style="display: flex; align-items: center; gap: 10px; font-size: 12px; color: var(--text-gray);">
            <input type="checkbox" id="check-fix"> é–‹å•Ÿèªæ³•è‡ªå‹•ä¿®æ­£å»ºè­°
        </div>
        <button class="action-btn" onclick="loadW3C()">è¼‰å…¥ W3C æ¨™æº–ç¯„ä¾‹</button>
        <button class="action-btn" onclick="toggleSettings()" style="background: #333;">é—œé–‰è¨­å®š</button>
    </div>
</div>

<input type="file" id="file-input" onchange="handleFile(event)" accept=".html,.css,.js,.txt,.md">

<script>
    /**
     * [è¨»è§£] æ ¸å¿ƒæ¸²æŸ“é‚è¼¯ï¼šå°‡ä»£ç¢¼æ³¨å…¥ iframe
     * é€™è£¡æ•´åˆäº† HTML + CSS + JS æˆç‚ºä¸€å€‹æš«æ™‚æ€§çš„ç¶²é 
     */
    function togglePreview(show) {
        const layer = document.getElementById('preview-layer');
        if(show) {
            const html = document.getElementById('code-html').value;
            const css = `<style>${document.getElementById('code-css').value}</style>`;
            const js = `<script>${document.getElementById('code-js').value}<\/script>`;
            const frame = document.getElementById('output-frame').contentWindow.document;
            frame.open();
            frame.write(html + css + js);
            frame.close();
            layer.classList.add('active');
        } else {
            layer.classList.remove('active');
        }
    }

    /**
     * [è¨»è§£] è‡ªå‹•å­˜æª”æ©Ÿåˆ¶ï¼šä½¿ç”¨ LocalStorage
     * æ¯æ¬¡æ‰“å­—éƒ½æœƒé–ƒçˆå³ä¸Šè§’çš„ã€Œå­˜æª”åœ–ç¤ºã€æä¾›å›é¥‹
     */
    function autoSave() {
        const data = {
            h: document.getElementById('code-html').value,
            c: document.getElementById('code-css').value,
            j: document.getElementById('code-js').value
        };
        localStorage.setItem('mobi_flagship_data', JSON.stringify(data));
        
        const icon = document.getElementById('save-indicator');
        icon.style.filter = 'drop-shadow(0 0 8px var(--syntax-blue))';
        icon.style.transform = 'scale(1.1)';
        setTimeout(() => { 
            icon.style.filter = 'none'; 
            icon.style.transform = 'scale(1)';
        }, 300);
    }

    /**
     * [è¨»è§£] ä¸‹è¼‰é‚è¼¯ï¼šæ”¯æ´è‡ªè¨‚æª”åèˆ‡æ ¼å¼
     */
    function downloadLogic() {
        const fmt = document.getElementById('dl-format').value;
        const name = prompt("è«‹è¼¸å…¥æª”æ¡ˆåç¨±ï¼š", "mobi_project") || "mobi_project";
        let content = "";
        let mime = "text/plain";

        if(fmt === 'html') {
            content = `<html><style>${document.getElementById('code-css').value}</style><body>${document.getElementById('code-html').value}<script>${document.getElementById('code-js').value}<\/script></body></html>`;
            mime = "text/html";
        } else {
            content = document.getElementById('code-html').value;
        }

        const blob = new Blob([content], {type: mime});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${name}.${fmt}`;
        a.click();
    }

    /**
     * [è¨»è§£] æª”æ¡ˆä¸Šå‚³è™•ç†
     */
    function handleFile(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            document.getElementById('code-html').value = event.target.result;
            autoSave();
        };
        reader.readAsText(file);
    }

    /**
     * [è¨»è§£] ä»‹é¢æ§åˆ¶å‡½æ•¸
     */
    function toggleSettings() { document.getElementById('settings-modal').classList.toggle('active'); }
    
    function changeLayout(val) { document.body.className = val; }

    function loadW3C() {
        document.getElementById('code-html').value = '<div class="card">\n  <h1>W3C Example</h1>\n  <p>é€™æ˜¯æ¨™æº–æ¸¬è©¦æ¨¡æ¿</p>\n</div>';
        document.getElementById('code-css').value = '.card { padding: 20px; border: 1px solid #ccc; border-radius: 8px; }';
        document.getElementById('code-js').value = 'console.log("Mobi IDE Ready");';
        toggleSettings();
        autoSave();
    }

    function clearAll() {
        if(confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å…§å®¹å—ï¼Ÿå­˜æª”å°‡è¢«æ¸…ç©ºã€‚")) {
            localStorage.removeItem('mobi_flagship_data');
            location.reload();
        }
    }

    // [åˆå§‹åŒ–]ï¼šå•Ÿå‹•æ™‚è®€å–å­˜æª”
    window.onload = () => {
        const saved = localStorage.getItem('mobi_flagship_data');
        if(saved) {
            const d = JSON.parse(saved);
            document.getElementById('code-html').value = d.h || "";
            document.getElementById('code-css').value = d.c || "";
            document.getElementById('code-js').value = d.j || "";
        }
    };
</script>
</body>
</html>
