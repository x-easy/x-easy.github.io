<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />

<!-- ===============================
     ğŸ“Œ Meta è¨­å®šï½œSEO + PWA åŸºç¤
     =============================== -->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#0b0d10" />
<title>Mobispace Media Vault</title>

<!-- ===============================
     ğŸ¨ UI æ¨£å¼ç³»çµ±ï¼ˆæ·±è‰²å“ç‰Œä¸»é¡Œï¼‰
     =============================== -->
<style>
/* ------------------------------
   å…¨åŸŸè®Šæ•¸ï½œå“ç‰Œè‰²ç³»å®šç¾©
   ------------------------------ */
:root {
  --bg: #0b0d10;
  --panel: #131720;
  --accent: #7dd3fc;
  --text: #e5e7eb;
  --muted: #6b7280;
  --radius: 14px;
}

/* ------------------------------
   åŸºç¤æ’ç‰ˆé‡è¨­
   ------------------------------ */
* { box-sizing: border-box; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

/* ------------------------------
   Header æ“ä½œåˆ—
   ------------------------------ */
header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(10px);
  padding: 1rem;
  display: flex;
  gap: 1rem;
  align-items: center;
}

header input {
  flex: 1;
  background: #111;
  border: 1px solid #222;
  border-radius: 999px;
  padding: .6rem 1rem;
  color: white;
}

/* ------------------------------
   å¡ç‰‡ Feed å®¹å™¨
   ------------------------------ */
#feed {
  padding: 1rem;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1rem;
}

/* ------------------------------
   å½±éŸ³å¡ç‰‡å…ƒä»¶
   ------------------------------ */
.card {
  background: var(--panel);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,.4);
  transition: transform .2s;
}
.card:hover {
  transform: translateY(-4px);
}

/* é è¦½ç¸®åœ– */
.card img {
  width: 100%;
  aspect-ratio: 16/9;
  object-fit: cover;
}

/* å¡ç‰‡å…§å®¹ */
.card .content {
  padding: .8rem;
}

/* æ¨™ç±¤æ¨£å¼ */
.tag {
  display: inline-block;
  font-size: .7rem;
  padding: .2rem .5rem;
  background: #1f2937;
  border-radius: 999px;
  margin-right: .3rem;
}

/* æ”¶è—æŒ‰éˆ• */
.fav {
  float: right;
  cursor: pointer;
  color: var(--muted);
}
.fav.active { color: gold; }

/* æ’­æ”¾å™¨å½ˆçª— */
#playerModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  display: none;
  place-items: center;
  z-index: 999;
}

#playerModal video {
  width: 90%;
  max-width: 900px;
  border-radius: var(--radius);
}
</style>

<!-- ===============================
     ğŸ“¦ ç¬¬ä¸‰æ–¹åº«è¼‰å…¥
     =============================== -->
<script src="https://cdn.jsdelivr.net/npm/minisearch@6.1.0/dist/umd/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body>

<!-- ===============================
     ğŸ§  SVG Icon Sprite
     =============================== -->
<svg style="display:none">
  <symbol id="icon-star" viewBox="0 0 24 24">
    <path fill="currentColor" d="M12 17.3l6.2 3.7-1.6-7 5.4-4.7-7.1-.6L12 2 9.1 8.7l-7.1.6 5.4 4.7-1.6 7z"/>
  </symbol>
</svg>

<!-- ===============================
     ğŸ” Header æ§åˆ¶åˆ—
     =============================== -->
<header>
  <input id="search" placeholder="æœå°‹çŸ¥è­˜åº«..." />
  <button onclick="showFavorites()">â­ æ”¶è—</button>
</header>

<!-- ===============================
     ğŸ“š Feed å®¹å™¨
     =============================== -->
<main id="feed"></main>

<!-- ===============================
     ğŸ¥ æ’­æ”¾å™¨ Modal
     =============================== -->
<div id="playerModal" onclick="closePlayer()">
  <video id="video" controls></video>
</div>

<script>
/* ======================================================
   ğŸ“¦ è³‡æ–™æ¨¡å‹ï¼šå½±ç‰‡å…§å®¹è³‡æ–™åº«ï¼ˆå¯æ›¿æ›æˆä½ è‡ªå·±çš„ï¼‰
   ====================================================== */
const DATA = [
  {
    id: "vid001",
    title: "HLS ä¸²æµæŠ€è¡“è§£æ",
    tags: ["å½±éŸ³", "å·¥ç¨‹"],
    cover: "https://images.unsplash.com/photo-1522199755839-a2bacb67c546",
    src: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"
  },
  {
    id: "vid002",
    title: "AI å·¥å…·éˆè¨­è¨ˆæ€ç¶­",
    tags: ["AI", "ç”¢å“"],
    cover: "https://images.unsplash.com/photo-1518770660439-4636190af475",
    src: "https://test-streams.mux.dev/test_001/stream.m3u8"
  }
];

/* ======================================================
   ğŸ§  IndexedDB æ°¸ä¹…å„²å­˜å±¤
   ====================================================== */
const db = indexedDB.open("mobispace-db", 1);
db.onupgradeneeded = e => {
  e.target.result.createObjectStore("fav", { keyPath: "id" });
};

/* ======================================================
   ğŸ” MiniSearch æœå°‹ç´¢å¼•
   ====================================================== */
const miniSearch = new MiniSearch({
  fields: ["title", "tags"],
  storeFields: ["title", "tags", "cover", "src", "id"]
});
miniSearch.addAll(DATA);

/* ======================================================
   ğŸ–¼ï¸ ç•«é¢æ¸²æŸ“
   ====================================================== */
const feed = document.getElementById("feed");

function render(list) {
  feed.innerHTML = list.map(v => `
    <div class="card">
      <img src="${v.cover}" onclick="play('${v.src}')" />
      <div class="content">
        <b>${v.title}</b>
        <span class="fav" onclick="toggleFav('${v.id}')">
          <svg width="18"><use href="#icon-star"/></svg>
        </span><br/>
        ${v.tags.map(t=>`<span class="tag">${t}</span>`).join("")}
      </div>
    </div>
  `).join("");
}
render(DATA);

/* ======================================================
   ğŸ¥ æ’­æ”¾å™¨é‚è¼¯ï¼ˆæ”¯æ´ HLS.jsï¼‰
   ====================================================== */
function play(url) {
  const modal = document.getElementById("playerModal");
  const video = document.getElementById("video");
  modal.style.display = "grid";

  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else {
    video.src = url;
  }
}

function closePlayer() {
  document.getElementById("playerModal").style.display = "none";
  document.getElementById("video").pause();
}

/* ======================================================
   â­ æ”¶è—ç³»çµ±
   ====================================================== */
function toggleFav(id) {
  db.onsuccess = e => {
    const tx = e.target.result.transaction("fav", "readwrite");
    const store = tx.objectStore("fav");
    store.put(DATA.find(v=>v.id===id));
  };
}

function showFavorites() {
  db.onsuccess = e => {
    const tx = e.target.result.transaction("fav");
    const store = tx.objectStore("fav");
    const req = store.getAll();
    req.onsuccess = () => render(req.result);
  };
}

/* ======================================================
   ğŸ” æœå°‹è¡Œç‚º
   ====================================================== */
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value;
  if(!q) return render(DATA);
  render(miniSearch.search(q).map(r=>r));
});
</script>
</body>
</html>