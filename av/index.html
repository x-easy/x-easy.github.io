<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: blob: data: 'unsafe-inline' 'unsafe-eval'">
<title>RSS Reader Pro</title>

<style>
:root{--bg:#fff;--text:#111;--card:#f2f2f2;--accent:#0066cc}
@media(prefers-color-scheme:dark){:root{--bg:#121212;--text:#eee;--card:#1e1e1e;--accent:#4da3ff}}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
header{padding:1rem;text-align:center;font-weight:bold}
main{max-width:960px;margin:auto;padding:1rem}
.controls{display:grid;gap:.5rem}
.item{background:var(--card);border-radius:14px;overflow:hidden;margin:1rem 0;box-shadow:0 2px 6px #0001}
.thumb{width:100%;aspect-ratio:16/9;object-fit:cover;filter:blur(8px);transition:.3s}
.thumb.loaded{filter:none}
.meta{font-size:.8rem;opacity:.7}
button{border:0;background:none;color:var(--accent);cursor:pointer}
.icon{width:16px;height:16px;fill:currentColor}
#player{position:fixed;inset:0;background:#000c;display:none;align-items:center;justify-content:center}
#player iframe{width:90%;height:60vh}
.skeleton{background:linear-gradient(90deg,#ccc,#eee,#ccc);height:200px;animation:sh 1.2s infinite}
@keyframes sh{0%{background-position:0}100%{background-position:200%}}
</style>
</head>
<body>

<header>üì° RSS Reader Pro</header>
<main>
  <div id="feed"></div>
</main>

<div id="player" onclick="closePlayer()"><iframe allowfullscreen></iframe></div>

<svg style="display:none">
  <symbol id="play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></symbol>
  <symbol id="heart" viewBox="0 0 24 24"><path d="M12 21s-8-4.6-8-10a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 5.4-8 10-8 10z"/></symbol>
</svg>

<script type="module">
// ============================
// IndexedDB Ê∞∏‰πÖÂÑ≤Â≠òÔºàÊî∂Ëóè + feed + ÁøªË≠ØÔºâ
// ============================
const dbReq=indexedDB.open("rss-pro",1);
let db;
dbReq.onupgradeneeded=e=>{
  const d=e.target.result;
  d.createObjectStore("fav",{keyPath:"link"});
  d.createObjectStore("feed",{keyPath:"link"});
};
dbReq.onsuccess=e=>db=e.target.result;
const store=(s,m)=>db.transaction(s,m).objectStore(s);

// ============================
// RSS ËºâÂÖ• + Âø´Âèñ
// ============================
const feeds=[
 {name:"18AV",url:"https://rss.app/feeds/eS2iB3hy0gfoMeSW.xml"},
 {name:"Hanime1",url:"https://rss.app/feeds/FuIYGgvZZ4yvY9js.xml"},
];
const proxy="https://api.rss2json.com/v1/api.json?rss_url=";

const feedEl=document.getElementById("feed");

function skeleton(){
  feedEl.innerHTML=[...Array(6)].map(()=>`<div class="item skeleton"></div>`).join("");
}

function pickImg(i){return i.thumbnail||i.enclosure?.link||"";}

function render(items){
  feedEl.innerHTML="";
  items.forEach(i=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <img class="thumb" src="${i.img}" onload="this.classList.add('loaded')">
      <div style="padding:.8rem">
        <b>${i.title}</b>
        <div class="meta">${i.source}ÔΩú${new Date(i.date).toLocaleString()}</div>
        <div>
          <button onclick="play('${i.link}')"><svg class="icon"><use href="#play"/></svg> Êí≠Êîæ</button>
          <button onclick='fav(${JSON.stringify(i)})'><svg class="icon"><use href="#heart"/></svg> Êî∂Ëóè</button>
        </div>
      </div>`;
    feedEl.appendChild(div);
  });
}

async function load(){
  skeleton();
  const res=await Promise.all(feeds.map(f=>
    fetch(proxy+encodeURIComponent(f.url))
    .then(r=>r.json())
    .then(d=>d.items.map(i=>({
      title:i.title,link:i.link,img:pickImg(i),
      source:f.name,date:i.pubDate
    })))
  ));
  const flat=res.flat();
  render(flat);
}
load();

// ============================
// Êî∂Ëóè
// ============================
window.fav=item=>{
  store("fav","readwrite").put(item);
  alert("Â∑≤Êî∂Ëóè");
};

// ============================
// Êí≠ÊîæÂô®
// ============================
window.play=url=>{
  const p=document.getElementById("player");
  p.style.display="flex";
  p.querySelector("iframe").src=url;
};
window.closePlayer=()=>{
  const p=document.getElementById("player");
  p.style.display="none";
  p.querySelector("iframe").src="";
};
</script>
</body>
</html>